{"version":3,"sources":["../../../lib/src/widget-library/orderable.directive.ts"],"names":[],"mappings":"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","file":"orderable.directive.js","sourceRoot":"","sourcesContent":["import { Directive, ElementRef, HostListener, Input, OnInit } from '@angular/core';\r\n\r\nimport { JsonSchemaFormService } from '../json-schema-form.service';\r\nimport { JsonPointer } from '../shared/jsonpointer.functions';\n/**\n * OrderableDirective\r\rEnables array elements to be reordered by dragging and dropping.\r\rOnly works for arrays that have at least two elements.\r\rAlso detects arrays-within-arrays, and correctly moves either\rthe child array element or the parent array element,\rdepending on the drop targert.\r\n */\nexport class OrderableDirective implements OnInit {\r\n  arrayPointer: string;\r\n  listen: boolean = false;\r\n  element: any;\r\n  overParentElement: boolean = false;\r\n  overChildElement: boolean = false;\r\n   orderable: boolean;\r\n   formID: number;\r\n   layoutNode: any;\r\n   layoutIndex: number[];\r\n   dataIndex: number[];\n/**\n * @param {?} elementRef\n * @param {?} jsf\n */\nconstructor(\nprivate elementRef: ElementRef,\nprivate jsf: JsonSchemaFormService\r\n  ) { }\n/**\n * @return {?}\n */\nngOnInit() {\r\n    if (this.orderable && this.layoutNode && this.layoutIndex && this.dataIndex) {\r\n      this.element = this.elementRef.nativeElement;\r\n      this.element.draggable = true;\r\n      this.arrayPointer = JsonPointer.compile(\r\n        JsonPointer.parse(this.jsf.getLayoutPointer(this)).slice(0, -1)\r\n      );\r\n      this.listen = true;\r\n    }\r\n  }\n/**\n * Listeners for movable element being dragged:\r\rdragstart: add 'dragging' class to element, set effectAllowed = 'move'\rdragover: set dropEffect = 'move'\rdragend: remove 'dragging' class from element\n * @param {?} event\n * @return {?}\n */\nonDragStart(event) {\r\n    if (this.listen) {\r\n      this.element.classList.add('dragging');\r\n      event.dataTransfer.effectAllowed = 'move';\r\n      // Hack to bypass stupid HTML drag-and-drop dataTransfer protection\r\n      // so drag source info will be available on dragenter\r\n      sessionStorage.setItem(this.arrayPointer,\r\n        this.dataIndex[this.dataIndex.length - 1] + ''\r\n      );\r\n      event.dataTransfer.setData('text/plain',\r\n        this.dataIndex[this.dataIndex.length - 1] + this.arrayPointer\r\n      );\r\n    }\r\n  }\n/**\n * @param {?} event\n * @return {?}\n */\nonDragOver(event) {\r\n    if (event.preventDefault) event.preventDefault();\r\n    event.dataTransfer.dropEffect = 'move';\r\n    return false;\r\n  }\n/**\n * @param {?} event\n * @return {?}\n */\nonDragEnd(event) {\r\n    event.preventDefault();\r\n    if (this.listen) {\r\n      this.element.classList.remove('dragging');\r\n    }\r\n  }\n/**\n * Listeners for stationary items being dragged over:\r\rdragenter: add 'drag-target-...' classes to element\rdragleave: remove 'drag-target-...' classes from element\rdrop: remove 'drag-target-...' classes from element, move dropped array item\n * @param {?} event\n * @return {?}\n */\nonDragEnter(event) {\r\n    // Part 1 of a hack, inspired by Dragster, to simulate mouseover and mouseout\r\n    // behavior while dragging items - http://bensmithett.github.io/dragster/\r\n    if (this.overParentElement) {\r\n      return this.overChildElement = true;\r\n    } else {\r\n      this.overParentElement = true;\r\n    }\r\n\r\n    if (this.listen) {\r\n      let /** @type {?} */ sourceArrayIndex = sessionStorage.getItem(this.arrayPointer);\r\n      if (sourceArrayIndex !== null) {\r\n        if (this.dataIndex[this.dataIndex.length - 1] < +sourceArrayIndex) {\r\n          this.element.classList.add('drag-target-top');\r\n        } else if (this.dataIndex[this.dataIndex.length - 1] > +sourceArrayIndex) {\r\n          this.element.classList.add('drag-target-bottom');\r\n        }\r\n      }\r\n    }\r\n  }\n/**\n * @param {?} event\n * @return {?}\n */\nonDragLeave(event) {\r\n    // Part 2 of the Dragster hack\r\n    if (this.overChildElement) {\r\n      this.overChildElement = false;\r\n    } else if (this.overParentElement) {\r\n      this.overParentElement = false;\r\n    }\r\n\r\n    if (!this.overParentElement && !this.overChildElement && this.listen) {\r\n      this.element.classList.remove('drag-target-top');\r\n      this.element.classList.remove('drag-target-bottom');\r\n    }\r\n  }\n/**\n * @param {?} event\n * @return {?}\n */\nonDrop(event) {\r\n    if (this.listen) {\r\n      this.element.classList.remove('drag-target-top');\r\n      this.element.classList.remove('drag-target-bottom');\r\n      // Confirm that drop target is another item in the same array as source item\r\n      const /** @type {?} */ sourceArrayIndex: number = +sessionStorage.getItem(this.arrayPointer);\r\n      if (sourceArrayIndex !== this.dataIndex[this.dataIndex.length - 1]) {\r\n        // Move array item\r\n        this.jsf.moveArrayItem(\r\n          this, sourceArrayIndex, this.dataIndex[this.dataIndex.length - 1]\r\n        );\r\n      }\r\n      sessionStorage.removeItem(this.arrayPointer);\r\n    }\r\n    return false;\r\n  }\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Directive, args: [{\r\n  selector: '[orderable]',\r\n}, ] },\n];\n/**\n * @nocollapse\n */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: ElementRef, },\n{type: JsonSchemaFormService, },\n];\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'orderable': [{ type: Input },],\n'formID': [{ type: Input },],\n'layoutNode': [{ type: Input },],\n'layoutIndex': [{ type: Input },],\n'dataIndex': [{ type: Input },],\n'onDragStart': [{ type: HostListener, args: ['dragstart', ['$event'], ] },],\n'onDragOver': [{ type: HostListener, args: ['dragover', ['$event'], ] },],\n'onDragEnd': [{ type: HostListener, args: ['dragend', ['$event'], ] },],\n'onDragEnter': [{ type: HostListener, args: ['dragenter', ['$event'], ] },],\n'onDragLeave': [{ type: HostListener, args: ['dragleave', ['$event'], ] },],\n'onDrop': [{ type: HostListener, args: ['drop', ['$event'], ] },],\n};\n}\n\nfunction OrderableDirective_tsickle_Closure_declarations() {\n/** @type {?} */\nOrderableDirective.decorators;\n/**\n * @nocollapse\n * @type {?}\n */\nOrderableDirective.ctorParameters;\n/** @type {?} */\nOrderableDirective.propDecorators;\n/** @type {?} */\nOrderableDirective.prototype.arrayPointer;\n/** @type {?} */\nOrderableDirective.prototype.listen;\n/** @type {?} */\nOrderableDirective.prototype.element;\n/** @type {?} */\nOrderableDirective.prototype.overParentElement;\n/** @type {?} */\nOrderableDirective.prototype.overChildElement;\n/** @type {?} */\nOrderableDirective.prototype.orderable;\n/** @type {?} */\nOrderableDirective.prototype.formID;\n/** @type {?} */\nOrderableDirective.prototype.layoutNode;\n/** @type {?} */\nOrderableDirective.prototype.layoutIndex;\n/** @type {?} */\nOrderableDirective.prototype.dataIndex;\n/** @type {?} */\nOrderableDirective.prototype.elementRef;\n/** @type {?} */\nOrderableDirective.prototype.jsf;\n}\n\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}